<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>egg-sequelize使用说明 | 攻城狮老李</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/image/favicon.ico">
    <script>
      var _hmt = _hmt || [];
      (function() {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?06c188d9b8c09d404bf72da888bbf210";
        var s = document.getElementsByTagName("script")[0]; 
        s.parentNode.insertBefore(hm, s);
      })();
      </script>
    <meta name="description" content="老李想给世界留下些东西">
    
    <link rel="preload" href="/assets/css/0.styles.e4d8b86b.css" as="style"><link rel="preload" href="/assets/js/app.8649458c.js" as="script"><link rel="preload" href="/assets/js/2.1b89d212.js" as="script"><link rel="preload" href="/assets/js/25.5ad4f816.js" as="script"><link rel="prefetch" href="/assets/js/10.386aa218.js"><link rel="prefetch" href="/assets/js/11.c4129596.js"><link rel="prefetch" href="/assets/js/12.2e7a4f45.js"><link rel="prefetch" href="/assets/js/13.0f8ec844.js"><link rel="prefetch" href="/assets/js/14.9283fb9e.js"><link rel="prefetch" href="/assets/js/15.e2a6b9a5.js"><link rel="prefetch" href="/assets/js/16.d9f486e4.js"><link rel="prefetch" href="/assets/js/17.e3508220.js"><link rel="prefetch" href="/assets/js/18.1b59155d.js"><link rel="prefetch" href="/assets/js/19.293c2609.js"><link rel="prefetch" href="/assets/js/20.0e069184.js"><link rel="prefetch" href="/assets/js/21.e18ca05a.js"><link rel="prefetch" href="/assets/js/22.4465c5a9.js"><link rel="prefetch" href="/assets/js/23.ceae80eb.js"><link rel="prefetch" href="/assets/js/24.12c16c2d.js"><link rel="prefetch" href="/assets/js/26.07b7d247.js"><link rel="prefetch" href="/assets/js/27.02d1e121.js"><link rel="prefetch" href="/assets/js/28.8af05ca4.js"><link rel="prefetch" href="/assets/js/29.ce44f9c3.js"><link rel="prefetch" href="/assets/js/3.18ee0144.js"><link rel="prefetch" href="/assets/js/30.3fd3998d.js"><link rel="prefetch" href="/assets/js/31.bfd6e584.js"><link rel="prefetch" href="/assets/js/32.6d852fde.js"><link rel="prefetch" href="/assets/js/33.b9829c28.js"><link rel="prefetch" href="/assets/js/34.d6c52051.js"><link rel="prefetch" href="/assets/js/35.1b68978e.js"><link rel="prefetch" href="/assets/js/36.6ad6cc13.js"><link rel="prefetch" href="/assets/js/37.b2c7e4a4.js"><link rel="prefetch" href="/assets/js/38.9b6f0dda.js"><link rel="prefetch" href="/assets/js/39.953a0d69.js"><link rel="prefetch" href="/assets/js/4.e05c873c.js"><link rel="prefetch" href="/assets/js/40.77a26b43.js"><link rel="prefetch" href="/assets/js/41.fb0800c6.js"><link rel="prefetch" href="/assets/js/42.591a6f05.js"><link rel="prefetch" href="/assets/js/43.0223287c.js"><link rel="prefetch" href="/assets/js/44.d8c5ba80.js"><link rel="prefetch" href="/assets/js/45.c4039b39.js"><link rel="prefetch" href="/assets/js/46.3cdf1f68.js"><link rel="prefetch" href="/assets/js/47.22800923.js"><link rel="prefetch" href="/assets/js/48.9fd7a084.js"><link rel="prefetch" href="/assets/js/49.aa9f655e.js"><link rel="prefetch" href="/assets/js/5.33233bc0.js"><link rel="prefetch" href="/assets/js/50.a0183dfa.js"><link rel="prefetch" href="/assets/js/51.406ae846.js"><link rel="prefetch" href="/assets/js/52.510cfd1a.js"><link rel="prefetch" href="/assets/js/53.ac658a8a.js"><link rel="prefetch" href="/assets/js/54.dcd7fb29.js"><link rel="prefetch" href="/assets/js/55.ea993d66.js"><link rel="prefetch" href="/assets/js/56.fa3d5e6f.js"><link rel="prefetch" href="/assets/js/57.b2ebd9b7.js"><link rel="prefetch" href="/assets/js/58.452639ab.js"><link rel="prefetch" href="/assets/js/59.c0a092d2.js"><link rel="prefetch" href="/assets/js/6.498ab014.js"><link rel="prefetch" href="/assets/js/60.4dec12aa.js"><link rel="prefetch" href="/assets/js/61.be9276d4.js"><link rel="prefetch" href="/assets/js/7.c1a82cd1.js"><link rel="prefetch" href="/assets/js/8.3ab8799a.js"><link rel="prefetch" href="/assets/js/9.3e2ab27d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e4d8b86b.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">攻城狮老李</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/日常随笔/" class="nav-link">
  日常随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专题笔记" class="dropdown-title"><span class="title">专题笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="专题笔记" class="mobile-dropdown-title"><span class="title">专题笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Favorites1.html" class="nav-link">
  网址收藏
</a></li><li class="dropdown-item"><!----> <a href="/devops/" class="nav-link">
  运维笔记
</a></li><li class="dropdown-item"><!----> <a href="/egg/" class="nav-link router-link-active">
  EGG笔记
</a></li><li class="dropdown-item"><!----> <a href="/golang/" class="nav-link">
  GOLANG笔记
</a></li><li class="dropdown-item"><!----> <a href="/deno/" class="nav-link">
  DENO笔记
</a></li><li class="dropdown-item"><!----> <a href="/openeuler/" class="nav-link">
  openEuler
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/ubuntu/" class="nav-link">
  Ubuntu
</a></li></ul></div></div><div class="nav-item"><a href="/mirrors/" class="nav-link">
  软件镜像
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Mirrors Select" class="dropdown-title"><span class="title">本站镜像</span> <span class="arrow down"></span></button> <button type="button" aria-label="Mirrors Select" class="mobile-dropdown-title"><span class="title">本站镜像</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.lidong.xin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gcslaoli.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub镜像
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gcslaoli.gitee.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee镜像
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Git" class="dropdown-title"><span class="title">Git</span> <span class="arrow down"></span></button> <button type="button" aria-label="Git" class="mobile-dropdown-title"><span class="title">Git</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/GCSLaoLi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/gcslaoli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><a href="/日常随笔/" class="nav-link">
  日常随笔
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="专题笔记" class="dropdown-title"><span class="title">专题笔记</span> <span class="arrow down"></span></button> <button type="button" aria-label="专题笔记" class="mobile-dropdown-title"><span class="title">专题笔记</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/Favorites1.html" class="nav-link">
  网址收藏
</a></li><li class="dropdown-item"><!----> <a href="/devops/" class="nav-link">
  运维笔记
</a></li><li class="dropdown-item"><!----> <a href="/egg/" class="nav-link router-link-active">
  EGG笔记
</a></li><li class="dropdown-item"><!----> <a href="/golang/" class="nav-link">
  GOLANG笔记
</a></li><li class="dropdown-item"><!----> <a href="/deno/" class="nav-link">
  DENO笔记
</a></li><li class="dropdown-item"><!----> <a href="/openeuler/" class="nav-link">
  openEuler
</a></li><li class="dropdown-item"><!----> <a href="/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/ubuntu/" class="nav-link">
  Ubuntu
</a></li></ul></div></div><div class="nav-item"><a href="/mirrors/" class="nav-link">
  软件镜像
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Mirrors Select" class="dropdown-title"><span class="title">本站镜像</span> <span class="arrow down"></span></button> <button type="button" aria-label="Mirrors Select" class="mobile-dropdown-title"><span class="title">本站镜像</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://www.lidong.xin" target="_blank" rel="noopener noreferrer" class="nav-link external">
  主站
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gcslaoli.github.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  GitHub镜像
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gcslaoli.gitee.io" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee镜像
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="Git" class="dropdown-title"><span class="title">Git</span> <span class="arrow down"></span></button> <button type="button" aria-label="Git" class="mobile-dropdown-title"><span class="title">Git</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/GCSLaoLi" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/gcslaoli" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Gitee
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>egg</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/egg/" aria-current="page" class="sidebar-link">EGG笔记</a></li><li><a href="/egg/Service.html" class="sidebar-link">服务(Service)分析</a></li><li><a href="/egg/egg-sequelize.html" aria-current="page" class="active sidebar-link">egg-sequelize使用说明</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#install" class="sidebar-link">Install</a></li><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#usage-configuration" class="sidebar-link">Usage &amp; configuration</a></li><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#model-files" class="sidebar-link">Model files</a></li><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#conventions" class="sidebar-link">Conventions</a></li><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#examples" class="sidebar-link">Examples</a></li><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#sync-model-to-db" class="sidebar-link">Sync model to db</a></li><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#migration" class="sidebar-link">Migration</a></li><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#recommended-example" class="sidebar-link">Recommended example</a></li><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#questions-suggestions" class="sidebar-link">Questions &amp; Suggestions</a></li><li class="sidebar-sub-header"><a href="/egg/egg-sequelize.html#license" class="sidebar-link">License</a></li></ul></li><li><a href="/egg/eggts-pkg.html" class="sidebar-link">eggts-pkg</a></li><li><a href="/egg/新建eggjs项目.html" class="sidebar-link">新建 eggjs 项目</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="egg-sequelize使用说明"><a href="#egg-sequelize使用说明" class="header-anchor">#</a> egg-sequelize使用说明</h1> <h2 id="install"><a href="#install" class="header-anchor">#</a> Install</h2> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token function">npm</span> i --save egg-sequelize
$ <span class="token function">npm</span> <span class="token function">install</span> --save mysql2 <span class="token comment"># For both mysql and mariadb dialects</span>

<span class="token comment"># Or use other database backend.</span>
$ <span class="token function">npm</span> <span class="token function">install</span> --save pg pg-hstore <span class="token comment"># PostgreSQL</span>
$ <span class="token function">npm</span> <span class="token function">install</span> --save tedious <span class="token comment"># MSSQL</span>
</code></pre></div><h2 id="usage-configuration"><a href="#usage-configuration" class="header-anchor">#</a> Usage &amp; configuration</h2> <blockquote><p>Read the <a href="https://eggjs.org/en/tutorials/sequelize.html" target="_blank" rel="noopener noreferrer">tutorials<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to see a full example.</p></blockquote> <ul><li>Enable plugin in <code>config/plugin.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span>sequelize <span class="token operator">=</span> <span class="token punctuation">{</span>
  enable<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token keyword">package</span><span class="token operator">:</span> <span class="token string">'egg-sequelize'</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li>Edit your own configurations in <code>conif/config.{env}.js</code></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span>sequelize <span class="token operator">=</span> <span class="token punctuation">{</span>
  dialect<span class="token operator">:</span> <span class="token string">'mysql'</span><span class="token punctuation">,</span> <span class="token comment">// support: mysql, mariadb, postgres, mssql</span>
  database<span class="token operator">:</span> <span class="token string">'test'</span><span class="token punctuation">,</span>
  host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
  port<span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
  username<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
  password<span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token comment">// delegate: 'myModel', // load all models to `app[delegate]` and `ctx[delegate]`, default to `model`</span>
  <span class="token comment">// baseDir: 'my_model', // load all files in `app/${baseDir}` as models, default to `model`</span>
  <span class="token comment">// exclude: 'index.js', // ignore `app/${baseDir}/index.js` when load models, support glob and array</span>
  <span class="token comment">// more sequelize options</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>You can also use the <code>connection uri</code> to configure the connection:</p> <div class="language-js extra-class"><pre class="language-js"><code>exports<span class="token punctuation">.</span>sequelize <span class="token operator">=</span> <span class="token punctuation">{</span>
  dialect<span class="token operator">:</span> <span class="token string">'mysql'</span><span class="token punctuation">,</span> <span class="token comment">// support: mysql, mariadb, postgres, mssql</span>
  connectionUri<span class="token operator">:</span> <span class="token string">'mysql://root:@127.0.0.1:3306/test'</span><span class="token punctuation">,</span>
  <span class="token comment">// delegate: 'myModel', // load all models to `app[delegate]` and `ctx[delegate]`, default to `model`</span>
  <span class="token comment">// baseDir: 'my_model', // load all files in `app/${baseDir}` as models, default to `model`</span>
  <span class="token comment">// exclude: 'index.js', // ignore `app/${baseDir}/index.js` when load models, support glob and array</span>
  <span class="token comment">// more sequelize options</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>egg-sequelize has a default sequelize options below</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token punctuation">{</span>
    delegate<span class="token operator">:</span> <span class="token string">'model'</span><span class="token punctuation">,</span>
    baseDir<span class="token operator">:</span> <span class="token string">'model'</span><span class="token punctuation">,</span>
    <span class="token function">logging</span><span class="token punctuation">(</span><span class="token parameter"><span class="token operator">...</span>args</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// if benchmark enabled, log used</span>
      <span class="token keyword">const</span> used <span class="token operator">=</span> <span class="token keyword">typeof</span> args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">===</span> <span class="token string">'number'</span> <span class="token operator">?</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms]</span><span class="token template-punctuation string">`</span></span> <span class="token operator">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
      app<span class="token punctuation">.</span>logger<span class="token punctuation">.</span><span class="token function">info</span><span class="token punctuation">(</span><span class="token string">'[egg-sequelize]%s %s'</span><span class="token punctuation">,</span> used<span class="token punctuation">,</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    host<span class="token operator">:</span> <span class="token string">'localhost'</span><span class="token punctuation">,</span>
    port<span class="token operator">:</span> <span class="token number">3306</span><span class="token punctuation">,</span>
    username<span class="token operator">:</span> <span class="token string">'root'</span><span class="token punctuation">,</span>
    benchmark<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    define<span class="token operator">:</span> <span class="token punctuation">{</span>
      freezeTableName<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      underscored<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>More documents please refer to <a href="http://docs.sequelizejs.com/manual/installation/usage.html" target="_blank" rel="noopener noreferrer">Sequelize.js<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <h2 id="model-files"><a href="#model-files" class="header-anchor">#</a> Model files</h2> <p>Please put models under <code>app/model</code> dir by default.</p> <h2 id="conventions"><a href="#conventions" class="header-anchor">#</a> Conventions</h2> <table><thead><tr><th>model file</th> <th>class name</th></tr></thead> <tbody><tr><td><code>user.js</code></td> <td><code>app.model.User</code></td></tr> <tr><td><code>person.js</code></td> <td><code>app.model.Person</code></td></tr> <tr><td><code>user_group.js</code></td> <td><code>app.model.UserGroup</code></td></tr> <tr><td><code>user/profile.js</code></td> <td><code>app.model.User.Profile</code></td></tr></tbody></table> <ul><li>Tables always has timestamp fields: <code>created_at datetime</code>, <code>updated_at datetime</code>.</li> <li>Use underscore style column name, for example: <code>user_id</code>, <code>comments_count</code>.</li></ul> <h2 id="examples"><a href="#examples" class="header-anchor">#</a> Examples</h2> <h3 id="standard"><a href="#standard" class="header-anchor">#</a> Standard</h3> <p>Define a model first.</p> <blockquote><p>NOTE: <code>options.delegate</code> default to <code>model</code>, so <code>app.model</code> is an <a href="http://docs.sequelizejs.com/class/lib/sequelize.js~Sequelize.html#instance-constructor-constructor" target="_blank" rel="noopener noreferrer">Instance of Sequelize<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, so you can use methods like: <code>app.model.sync, app.model.query ...</code></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/model/user.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span> <span class="token constant">DATE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span>Sequelize<span class="token punctuation">;</span>

  <span class="token keyword">const</span> User <span class="token operator">=</span> app<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    login<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    last_sign_in_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
    created_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
    updated_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  User<span class="token punctuation">.</span><span class="token function-variable function">findByLogin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">login</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      where<span class="token operator">:</span> <span class="token punctuation">{</span>
        login<span class="token operator">:</span> login
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// don't use arraw function</span>
  <span class="token class-name">User</span><span class="token punctuation">.</span>prototype<span class="token punctuation">.</span><span class="token function-variable function">logSignin</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token punctuation">{</span> last_sign_in_at<span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> User<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

</code></pre></div><p>Now you can use it in your controller:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/controller/user.js</span>
<span class="token keyword">class</span> <span class="token class-name">UserController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> users<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">.</span><span class="token function">findByLogin</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>params<span class="token punctuation">.</span>login<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> user<span class="token punctuation">.</span><span class="token function">logSignin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> user<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="associate"><a href="#associate" class="header-anchor">#</a> Associate</h3> <p>Define all your associations in <code>Model.associate()</code> and egg-sequelize will execute it after all models loaded. See example below.</p> <h3 id="multiple-datasources"><a href="#multiple-datasources" class="header-anchor">#</a> Multiple Datasources</h3> <p>egg-sequelize support load multiple datasources independently. You can use <code>config.sequelize.datasources</code> to configure and load multiple datasources.</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// config/config.default.js</span>
exports<span class="token punctuation">.</span>sequelize <span class="token operator">=</span> <span class="token punctuation">{</span>
  datasources<span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">{</span>
      delegate<span class="token operator">:</span> <span class="token string">'model'</span><span class="token punctuation">,</span> <span class="token comment">// load all models to app.model and ctx.model</span>
      baseDir<span class="token operator">:</span> <span class="token string">'model'</span><span class="token punctuation">,</span> <span class="token comment">// load models from `app/model/*.js`</span>
      database<span class="token operator">:</span> <span class="token string">'biz'</span><span class="token punctuation">,</span>
      <span class="token comment">// other sequelize configurations</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">{</span>
      delegate<span class="token operator">:</span> <span class="token string">'admninModel'</span><span class="token punctuation">,</span> <span class="token comment">// load all models to app.adminModel and ctx.adminModel</span>
      baseDir<span class="token operator">:</span> <span class="token string">'admin_model'</span><span class="token punctuation">,</span> <span class="token comment">// load models from `app/admin_model/*.js`</span>
      database<span class="token operator">:</span> <span class="token string">'admin'</span><span class="token punctuation">,</span>
      <span class="token comment">// other sequelize configurations</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>Then we can define model like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/model/user.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span> <span class="token constant">DATE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span>Sequelize<span class="token punctuation">;</span>

  <span class="token keyword">const</span> User <span class="token operator">=</span> app<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    login<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    last_sign_in_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
    created_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
    updated_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> User<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token comment">// app/admin_model/user.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span> <span class="token constant">DATE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span>Sequelize<span class="token punctuation">;</span>

  <span class="token keyword">const</span> User <span class="token operator">=</span> app<span class="token punctuation">.</span>adminModel<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    login<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    last_sign_in_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
    created_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
    updated_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> User<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>If you define the same model for different datasource, the same model file will be excute twice for different database, so we can use the secound argument to get the sequelize instance:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/model/user.js</span>
<span class="token comment">// if this file will load multiple times for different datasource</span>
<span class="token comment">// we can use the secound argument to get the sequelize instance</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">app<span class="token punctuation">,</span> model</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span> <span class="token constant">DATE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span>Sequelize<span class="token punctuation">;</span>

  <span class="token keyword">const</span> User <span class="token operator">=</span> model<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    login<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">,</span>
    name<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    password<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    age<span class="token operator">:</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    last_sign_in_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
    created_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
    updated_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> User<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="customize-sequelize"><a href="#customize-sequelize" class="header-anchor">#</a> Customize Sequelize</h3> <p>By default, egg-sequelize will use sequelize@5, you can cusomize sequelize version by pass sequelize instance with <code>config.sequelize.Sequelize</code> like this:</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// config/config.default.js</span>
exports<span class="token punctuation">.</span>sequelize <span class="token operator">=</span> <span class="token punctuation">{</span>
  Sequelize<span class="token operator">:</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">'sequelize'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="full-example"><a href="#full-example" class="header-anchor">#</a> Full example</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/model/post.js</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token constant">STRING</span><span class="token punctuation">,</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span> <span class="token constant">DATE</span> <span class="token punctuation">}</span> <span class="token operator">=</span> app<span class="token punctuation">.</span>Sequelize<span class="token punctuation">;</span>

  <span class="token keyword">const</span> Post <span class="token operator">=</span> app<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">define</span><span class="token punctuation">(</span><span class="token string">'Post'</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
    name<span class="token operator">:</span> <span class="token constant">STRING</span><span class="token punctuation">(</span><span class="token number">30</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    user_id<span class="token operator">:</span> <span class="token constant">INTEGER</span><span class="token punctuation">,</span>
    created_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
    updated_at<span class="token operator">:</span> <span class="token constant">DATE</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  Post<span class="token punctuation">.</span><span class="token function-variable function">associate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Post<span class="token punctuation">.</span><span class="token function">belongsTo</span><span class="token punctuation">(</span>app<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token punctuation">{</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'user'</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">return</span> Post<span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app/controller/post.js</span>
<span class="token keyword">class</span> <span class="token class-name">PostController</span> <span class="token keyword">extends</span> <span class="token class-name">Controller</span> <span class="token punctuation">{</span>
  <span class="token keyword">async</span> <span class="token function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> posts <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Post<span class="token punctuation">.</span><span class="token function">findAll</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      attributes<span class="token operator">:</span> <span class="token punctuation">[</span> <span class="token string">'id'</span><span class="token punctuation">,</span> <span class="token string">'user_id'</span> <span class="token punctuation">]</span><span class="token punctuation">,</span>
      include<span class="token operator">:</span> <span class="token punctuation">{</span> model<span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>User<span class="token punctuation">,</span> <span class="token keyword">as</span><span class="token operator">:</span> <span class="token string">'user'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      where<span class="token operator">:</span> <span class="token punctuation">{</span> status<span class="token operator">:</span> <span class="token string">'publish'</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
      order<span class="token operator">:</span> <span class="token string">'id desc'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> posts<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">show</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Post<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    post<span class="token punctuation">.</span><span class="token function">setDataValue</span><span class="token punctuation">(</span><span class="token string">'user'</span><span class="token punctuation">,</span> user<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> post<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">async</span> <span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> post <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>model<span class="token punctuation">.</span>Post<span class="token punctuation">.</span><span class="token function">findByPk</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">await</span> post<span class="token punctuation">.</span><span class="token function">destroy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token punctuation">{</span> success<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="sync-model-to-db"><a href="#sync-model-to-db" class="header-anchor">#</a> Sync model to db</h2> <p><strong>We strongly recommend you to use <a href="http://docs.sequelizejs.com/manual/tutorial/migrations.html" target="_blank" rel="noopener noreferrer">Sequelize - Migrations<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to create or migrate database.</strong></p> <p><strong>This code should only be used in development.</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// {app_root}/app.js</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token parameter">app</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>env <span class="token operator">===</span> <span class="token string">'local'</span> <span class="token operator">||</span> app<span class="token punctuation">.</span>config<span class="token punctuation">.</span>env <span class="token operator">===</span> <span class="token string">'unittest'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    app<span class="token punctuation">.</span><span class="token function">beforeStart</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> app<span class="token punctuation">.</span>model<span class="token punctuation">.</span><span class="token function">sync</span><span class="token punctuation">(</span><span class="token punctuation">{</span>force<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="migration"><a href="#migration" class="header-anchor">#</a> Migration</h2> <p>Using <a href="https://github.com/sequelize/cli" target="_blank" rel="noopener noreferrer">sequelize-cli<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to help manage your database, data structures and seed data. Please read <a href="http://docs.sequelizejs.com/manual/tutorial/migrations.html" target="_blank" rel="noopener noreferrer">Sequelize - Migrations<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> to learn more infomations.</p> <h2 id="recommended-example"><a href="#recommended-example" class="header-anchor">#</a> Recommended example</h2> <ul><li>https://github.com/eggjs/examples/tree/master/sequelize/</li></ul> <h2 id="questions-suggestions"><a href="#questions-suggestions" class="header-anchor">#</a> Questions &amp; Suggestions</h2> <p>Please open an issue <a href="https://github.com/eggjs/egg/issues" target="_blank" rel="noopener noreferrer">here<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>.</p> <h2 id="license"><a href="#license" class="header-anchor">#</a> License</h2> <p><a href="LICENSE">MIT</a></p></div> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated:</span> <span class="time">2020/6/11 上午10:14:02</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/egg/Service.html" class="prev">
        服务(Service)分析
      </a></span> <span class="next"><a href="/egg/eggts-pkg.html">
        eggts-pkg
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.8649458c.js" defer></script><script src="/assets/js/2.1b89d212.js" defer></script><script src="/assets/js/25.5ad4f816.js" defer></script>
  </body>
</html>
